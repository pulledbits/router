<?php
namespace Teach\Entities;

/**
 * Generated by PHPUnit_SkeletonGenerator on 2015-10-14 at 13:44:20.
 */
class ContactmomentTest extends \PHPUnit_Framework_TestCase // extends \PHPUnit_Extensions_Database_TestCase
{
//     /**
//      * @return PHPUnit_Extensions_Database_DB_IDatabaseConnection
//      */
//     public function getConnection()
//     {
//         $pdo = new PDO('sqlite::memory:');
//         $this->cr
//         return $this->createDefaultDBConnection($pdo, ':memory:');
//     }

//     /**
//      * @return PHPUnit_Extensions_Database_DataSet_IDataSet
//      */
//     public function getDataSet()
//     {
//         return $this->
//         return $this->createFlatXMLDataSet(dirname(__FILE__).'/_files/guestbook-seed.xml');
//     }
    
    public function testCreateLesplan()
    {
        $mysqliStatementMock = $this->getMock('\mysqli_stmt', array('fetch_assoc'), array(), '', false);
        $mysqliStatementMock->expects($this->any())->method('fetch_assoc')->willReturn([
            "opleiding" => 'HBO-informatica (voltijd)',
            "lesplan_id" => "1",
            "les" => "",
            "vak" => "",
            "doelgroep_grootte" => "",
            "doelgroep_ervaring" => "",
            "doelgroep_beschrijving" => "",
            "starttijd" => "",
            "eindtijd" => "",
            "duur" => "",
            "beschikbaar" => "",
            "ruimte" => "",
            "opmerkingen" => "",
            "activerende_opening_id" => "",
            "focus_id" => "",
            "voorstellen_id" => "",
            "kennismaken_id" => "",
            "terugblik_id" => "",
            "huiswerk_id" => "",
            "evaluatie_id" => "",
            "pakkend_slot_id" => ""
        ]);
        $mysqliMock = $this->getMock('\mysqli', array('query'));
        $mysqliMock->expects($this->any())->method('query')->with("
            SELECT 
                'HBO-informatica (voltijd)' AS opleiding,
                les.id AS lesplan_id,
                les.naam AS les,
                module.naam AS vak,
                doelgroep.grootte AS doelgroep_grootte,
                doelgroep.ervaring AS doelgroep_ervaring,
                doelgroep.beschrijving AS doelgroep_beschrijving,
                contactmoment.starttijd AS starttijd,
                contactmoment.eindtijd AS eindtijd,
                SUM(activiteit.tijd) + (
                    SELECT SUM(activiteit.tijd) 
                    FROM thema 
                    LEFT JOIN activiteit ON activiteit.id IN (
                        thema.ervaren_id,
                        thema.reflecteren_id,
                        thema.conceptualiseren_id,
                        thema.toepassen_id
                    )
                    WHERE thema.les_id = les.id
                ) as duur,
                TIMESTAMPDIFF(MINUTE, contactmoment.starttijd, contactmoment.eindtijd) as beschikbaar,
                contactmoment.ruimte,
                les.opmerkingen,
                les.activerende_opening_id,
                les.focus_id,
                les.voorstellen_id,
                les.kennismaken_id,
                les.terugblik_id,
                les.huiswerk_id,
                les.evaluatie_id,
                les.pakkend_slot_id
            FROM contactmoment
            JOIN les ON les.id = contactmoment.les_id
            JOIN module ON module.id = les.module_id
            JOIN doelgroep ON doelgroep.id = les.doelgroep_id
            
            LEFT JOIN activiteit ON activiteit.id IN (
                les.activerende_opening_id,
                les.focus_id,
                les.voorstellen_id,
                les.kennismaken_id,
                les.terugblik_id,
                les.huiswerk_id,
                les.evaluatie_id,
                les.pakkend_slot_id
            )
            WHERE 
                contactmoment.id = 1
            GROUP BY
                contactmoment.id
        ")->willReturn($mysqliStatementMock);
        
        $object = new Contactmoment($mysqliMock, '1');
        $factory = new \Teach\Interactors\Web\Lesplan\Factory();
        $lesplanlayout = $object->createLesplan($factory);
        $this->assertInstanceOf('\Teach\Interactors\Web\Lesplan', $lesplanlayout);
    }
}
